#!/usr/bin/env node

var catversions = require('../')
  , colors = require('colors')
  , versionRegex = /\d+\.\d+\.\d+/
  , groupDev = process.argv.indexOf('--dev') > -1
  , lib = require('../lib')

catversions('.', function (err, dirs) {
  if (err) throw err

  var keys = Object.keys(dirs)
    , projectsPadding = lib.rightPadding(keys)
    , devKeys = []
    , versionsPadding
    , vs
    , v
    , devVersion

  vs = keys.map(function (key) {
    var dev = dirs[key].split(versionRegex)[1]
    return dirs[key].replace(dev, '').replace(/\.$/, '')
  })

  versionsPadding = lib.leftPadding(vs)

  if (groupDev) {
    keys = keys
      .filter(function (key) {
        var hasDev = dirs[key].replace(versionRegex, '').length > 0

        if (hasDev) {
          devKeys.push(key)
        }

        return !hasDev
      })
      .sort()

    devKeys.sort()
  }

  keys
    .concat(devKeys)
    .forEach(function (dir) {
      devVersion = dirs[dir].split(versionRegex)[1]
      v = dirs[dir].replace(devVersion, '')
      console.log(projectsPadding(dir).cyan + ' ' + versionsPadding(v) + devVersion.red)
    })
})
